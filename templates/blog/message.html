{% extends "base.html" %}
{% block title %}
    留言板
{% endblock %}
{% block path %}
    当前位置&nbsp;:&nbsp;<a href = "{% url 'home'%}">首页&nbsp;</a>»&nbsp;留言板
{% endblock %}
{% block content %}

    <style type="text/css">
        #set_messages{margin-top: 30px; margin-left: 10px;}
        #set_messages h5{margin-top: -10px; margin-left: -10px; color: #4398ed;}
        #set_messages ul li{list-style: none; border-bottom: 1px dashed #e5e5e5; padding: 13px 0 11px;}
        #set_messages ul li p{text-indent: 3.5em; word-break: break-all; word-wrap: break-word;}
        #set_messages ul li div{float: left; margin-right: 10px; margin-top: -5px;}
        #messages_time{float: right; font-size: smaller; color: silver; margin-top: 3px;}
    </style>

    <div>
        <section id="recent-comments" class="widget widget_recent_comments">
            <h6 style="margin-top: -10px; margin-left: -10px;">主人寄语</h6>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-size: smaller">欢迎访问我的博客，你可以在下面留下你的足迹.^_^</span>
        </section>
    </div>

    <form style="margin-top: 15px;" class="form-horizontal" id="message_form">
    {% csrf_token %}
        <div class="row form-inline">
            <div class="form-group">
                <div class="col-md-6">
                    <input type="text" placeholder="姓名(必填)" required="required" name="name" id="name" class="form-control input-sm" style="width: 348px;">
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-6">
                    <input type="email" placeholder="邮箱(必填)" required="required" name="email" id="email" class="form-control input-sm" style="width: 348px;">
                </div>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-12">
                <textarea name="messages" id="messages" placeholder="留言内容(必填)" required="required" class="form-control" rows="8" style="resize: none;"></textarea>
            </div>
        </div>
        <div style="text-align: right; margin-top: -10px;">
            <button type="submit" class="btn btn-default" onclick="create_messages()">发表</button>
        </div>
    </form>

    留言({{ messages_num | length }})
    
    <hr/>

    <div id="set_messages">
        <section>
            <h5><i class="glyphicon glyphicon-comment"></i> 近期留言</h5>
            <ul id="itemContainer">
                {% for message in messages%}
                    <li>
                        <div><img src="/static/css/head.png" height="40px" width="40px" style="border-radius: 40px;"></div>
                        <div class="clearfix"></div>
                        <span style="color: #4398ed">{{ message.name }}</span>
                        <span id="messages_time"><i class="glyphicon glyphicon-calendar"></i> {{ message.created_at }}</span>
                        <div class="clearfix"></div>
                        <br/><br/>
                        <p>{{ message.content|safe }}</p>
                    </li>
                {% endfor %}
            </ul>
        </section>
    </div>
    <div class="holder"></div>

    <script type="text/javascript">
        $(function(){
            $("div.holder").jPages({
                containerID : "itemContainer",
                first: '首页',
                last: '尾页',
                previous: '上页',
                next : '下页',
                perPage : 5, //每页显示数据为多少行
                startPage: 1, //起始页
                startRange : 2, //开始页码为2个
                midRange : 3, //最多显示几个页码页码,其余用..代替
                ndRange: 2, //结束页码为2个
                keyBrowse : true
            });
        });
        function create_messages() {
            var name = $('#name').val();
            var email = $('#email').val();
            var messages = $('#messages').val();
            if (name.length != 0 && email.length != 0 && messages.length != 0) {
                $.ajax({
                    async: false,
                    url: '/create/messages',
                    type: 'POST',
                    dataType: 'json',
                    data: add_csrf_token({
                        'name': name,
                        'email': email,
                        'messages': messages
                    }),
                    success: function (data) {
                        if (data['success'] == true) {
                            alert(data['message']);
                            window.location.reload()
                        }else{
                            alert(data['message']);
                        }
                    }
                })
            }else{
                alert('数据不能为空！')
            }
        }
    </script>

{% endblock %}

{% block side %}
	{% include "blog/_side.html" %}
{% endblock %}
